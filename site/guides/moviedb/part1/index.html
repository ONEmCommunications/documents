



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://developer-portal.onem.zone/guides/moviedb/part1/">
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../assets/favicon.ico">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-4.1.0">
    
    
      
        <title>Part 1 - Setting up - Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.982221ab.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-palette.224b79ff.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../../../assets/javascripts/modernizr.01ccdecf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/styles.css">
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-128421206-6", "developer-docs.onem.zone")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="blue">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#introduction" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://developer-portal.onem.zone/" title="Documentation" class="md-header-nav__button md-logo">
          
            <img src="../../../assets/onem-logo.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Documentation
            </span>
            <span class="md-header-nav__topic">
              Part 1 - Setting up
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://developer-portal.onem.zone/" title="Documentation" class="md-nav__button md-logo">
      
        <img src="../../../assets/onem-logo.svg" width="48" height="48">
      
    </a>
    Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../how-it-works/" title="How it works" class="md-nav__link">
      How it works
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Getting started
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Getting started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../getting-started/" title="Choose your language" class="md-nav__link">
      Choose your language
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../getting_started/nodejs/" title="Node.js" class="md-nav__link">
      Node.js
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-3" type="checkbox" id="nav-3-3">
    
    <label class="md-nav__link" for="nav-3-3">
      Python
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-3">
        Python
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../getting_started/python_prereq/" title="Pre-requisites" class="md-nav__link">
      Pre-requisites
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../getting_started/python_run_local/" title="Running on localhost" class="md-nav__link">
      Running on localhost
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../getting_started/running-in-production/" title="Running in production" class="md-nav__link">
      Running in production
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../ids-profile/" title="IDs & Profile" class="md-nav__link">
      IDs & Profile
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Core elements
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Core elements
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../core/menus/" title="Menus" class="md-nav__link">
      Menus
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../core/forms/" title="Forms" class="md-nav__link">
      Forms
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../core/verbs/" title="Verbs" class="md-nav__link">
      Verbs
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Channels
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Channels
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../core/web_verbs/" title="Web widget verbs" class="md-nav__link">
      Web widget verbs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-2" type="checkbox" id="nav-6-2">
    
    <label class="md-nav__link" for="nav-6-2">
      SMS
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-2">
        SMS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../core/paging/" title="SMS paging" class="md-nav__link">
      SMS paging
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../core/accessing-sms/" title="SMS user access" class="md-nav__link">
      SMS user access
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../core/reserved_verbs/" title="SMS reserved verbs" class="md-nav__link">
      SMS reserved verbs
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" checked>
    
    <label class="md-nav__link" for="nav-7">
      Guides
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-1" type="checkbox" id="nav-7-1" checked>
    
    <label class="md-nav__link" for="nav-7-1">
      Build a omni-channel micro-app with Node.js and Express in 2 hours
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-1">
        Build a omni-channel micro-app with Node.js and Express in 2 hours
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Part 1 - Setting up
      </label>
    
    <a href="./" title="Part 1 - Setting up" class="md-nav__link md-nav__link--active">
      Part 1 - Setting up
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" title="Introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pre-requisites" title="Pre-requisites" class="md-nav__link">
    Pre-requisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#micro-app-basics" title="Micro-app basics" class="md-nav__link">
    Micro-app basics
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#project-structure-and-code" title="Project Structure and Code" class="md-nav__link">
    Project Structure and Code
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running" title="Running" class="md-nav__link">
    Running
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../part2/" title="Part 2 - Adding a form" class="md-nav__link">
      Part 2 - Adding a form
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-2" type="checkbox" id="nav-7-2">
    
    <label class="md-nav__link" for="nav-7-2">
      Building a post board micro-app
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-2">
        Building a post board micro-app
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../use_case/post_demo_app_intro/" title="Basics" class="md-nav__link">
      Basics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../use_case/postv1/" title="Micro app landing" class="md-nav__link">
      Micro app landing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../use_case/postv2/" title="Search through posts" class="md-nav__link">
      Search through posts
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Reference
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../building/response/" title="Response" class="md-nav__link">
      Response
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../building/menu/" title="Menu" class="md-nav__link">
      Menu
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../building/form/" title="Form" class="md-nav__link">
      Form
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../building/html-tags/" title="HTML tags" class="md-nav__link">
      HTML tags
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" title="Introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pre-requisites" title="Pre-requisites" class="md-nav__link">
    Pre-requisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#micro-app-basics" title="Micro-app basics" class="md-nav__link">
    Micro-app basics
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#project-structure-and-code" title="Project Structure and Code" class="md-nav__link">
    Project Structure and Code
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running" title="Running" class="md-nav__link">
    Running
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Part 1 - Setting up</h1>
                
                <h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>In this article, I’ll show you how to build an example micro-app from scratch using our simple Node.js SDK. The tutorial assumes a basic knowledge of Node.js.</p>
<p>We’ll retrieve the movie details courtesy of the <a href="https://www.themoviedb.org/documentation/api">free api</a> provided by http://themoviedb.org (please make sure to abide by their terms)</p>
<p><img style="height:auto;width:100%" src="/assets/moviedb/backdrop.png"/></p>
<p>The ONEm platform lets you host your micro-app anywhere on the Internet. For local testing, We’ll use ngrok to provide a publicly accessible URL so that we have a bridge between our app running on localhost and the ONEm Framework.</p>
<h2 id="pre-requisites">Pre-requisites<a class="headerlink" href="#pre-requisites" title="Permanent link">&para;</a></h2>
<ol>
<li>Sign up for a free themoveidb api key <a href="https://www.themoviedb.org/documentation/api">here</a></li>
<li>Sign up for a free ONEm developer account <a href="https://developer-portal.onem.zone">here</a></li>
<li>Install ngrok from <a href="https://ngrok.com/">here</a></li>
</ol>
<h2 id="micro-app-basics">Micro-app basics<a class="headerlink" href="#micro-app-basics" title="Permanent link">&para;</a></h2>
<p>When a user makes a request from a web-widget or via SMS, the ONEm Framework will invoke an HTTP callback to the micro-app’s web server. The micro-app should respond with HTTP status code 200 and include, in the response body, some JSON which tells the ONEm Framework how to render the response to the user.</p>
<p>Our <a href="https://www.npmjs.com/package/onemsdk">Node.js SDK</a> provides an abstraction of the JSON format so you don’t have to worry about the details. You have two options, you can use the SDK to produce JSON by passing parameters to the functions provided, or alternatively you can use a templating library and write your micro-app’s views in HTML :) In this tutorial, we’ll be using the second option and specifically <a href="https://pugjs.org/api/getting-started.html">pug</a> as the templating language, you can use <a href="https://ejs.co/">ejs</a> instead if you prefer.</p>
<p>Ok, enough chat, let’s get coding!</p>
<h2 id="project-structure-and-code">Project Structure and Code<a class="headerlink" href="#project-structure-and-code" title="Permanent link">&para;</a></h2>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>The code used in this tutorial can be accessed via the git repository <a href="https://github.com/chrishornmem/movie-microapp">here</a>.</p>
</div>
<p>Our project structure will look like this:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>/
 index.js
 package.json
.env
/app_api
  /routes
    index.js
  /views
    landing.pug
    movieView.pug
/public
  index.html
</pre></div>
</td></tr></table>

<p>Install Express and the project’s base dependencies:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$ npm install express dotenv jwt-simple request-promise url-join
</pre></div>
</td></tr></table>

<p>We’ll also use the ONEm Framework’s Node.js SDK:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$ npm install onemsdk
</pre></div>
</td></tr></table>

<p>Create an <code>index.js</code> in the project root with the following content:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;dotenv&#39;</span><span class="p">).</span><span class="nx">config</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">api</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./app_api/routes&#39;</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">PORT</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span> <span class="o">||</span> <span class="mi">3000</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/public&#39;</span><span class="p">));</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/api&#39;</span><span class="p">,</span> <span class="nx">api</span><span class="p">)</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">sendFile</span><span class="p">(</span><span class="s1">&#39;/public/index.html&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">root</span><span class="o">:</span> <span class="nx">__dirname</span> <span class="p">})</span>
<span class="p">})</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">sendFile</span><span class="p">(</span><span class="s1">&#39;/public/index.html&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">root</span><span class="o">:</span> <span class="nx">__dirname</span> <span class="p">})</span>
<span class="p">})</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/*&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">sendFile</span><span class="p">(</span><span class="s1">&#39;/public/index.html&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">root</span><span class="o">:</span> <span class="nx">__dirname</span> <span class="p">})</span>
<span class="p">})</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">PORT</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Example micro-app listening on port </span><span class="si">${</span><span class="nx">PORT</span><span class="si">}</span><span class="sb">`</span><span class="p">))</span>
</pre></div>
</td></tr></table>

<p>When users make requests from our micro-app, such as selecting a menu option or submitting a form, the ONEm Framework will issue a HTTP request to the micro-app’s callback path. In the index.js we set /api as the ‘basepath’ for all requests coming from the ONEm Framework.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/api&#39;</span><span class="p">,</span> <span class="nx">api</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>When the micro-app is launched for the first time by a user, the ONEm Framework will display the micro-app’s “landing page”. This is a bit like the index.html of a typical web application. The landing page is invoked by the ONEm Framework issuing a request to the micro-app’s API base path, in our case <strong>/api</strong>.</p>
<p>So we’ll want our app to handle a basic call to <code>GET /api</code> and respond with some initial content that the user will see.</p>
<p>For our example, we’ll create a static menu, so that our users can view three different movies:</p>
<div style="text-align:center">
    <img style="height:425;width:auto" src="/assets/moviedb/widget.png"/>
</div>

<p>When the user clicks on a movie title, we’ll show the movie’s image and description.</p>
<p>First off, let’s create the landing menu options by creating a <code>landing.pug</code> in the <strong>/views</strong> folder:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nt">section</span>
  <span class="nt">header</span> Movie Menu
  <span class="nt">ul</span>
    <span class="nt">li</span>
        <span class="nt">a</span>(<span class="na">href=</span><span class="s">&#39;/movie/76341/&#39;</span>) Mad max
    <span class="nt">li</span>
        <span class="nt">a</span>(<span class="na">href=</span><span class="s">&#39;/movie/419704/&#39;</span>) Ad Astra
    <span class="nt">li</span>
        <span class="nt">a</span>(<span class="na">href=</span><span class="s">&#39;/movie/454626/&#39;</span>) Sonic the Hedgehog
</pre></div>
</td></tr></table>

<p>And let’s connect the base route in Express in <code>/routes/index.js</code>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">jwt</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;jwt-simple&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;request-promise&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">urlJoin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;url-join&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="p">{</span> <span class="nx">loadTemplate</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;onemsdk&#39;</span><span class="p">).</span><span class="nx">parser</span>
<span class="kr">const</span> <span class="p">{</span> <span class="nx">Response</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;onemsdk&#39;</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">api</span> <span class="o">=</span> <span class="nx">express</span><span class="p">.</span><span class="nx">Router</span><span class="p">()</span>

<span class="c1">// get this by signing up for an account at https://www.themoviedb.org/</span>
<span class="kr">const</span> <span class="nx">READ_ACCESS_TOKEN</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">READ_ACCESS_TOKEN</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">READ_ACCESS_TOKEN</span><span class="p">)</span> <span class="k">throw</span> <span class="s2">&quot;themoviedb.org READ_ACCESS_TOKEN not found in environment variables&quot;</span>

<span class="kr">const</span> <span class="nx">moviedbProps</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">baseUrl</span><span class="o">:</span> <span class="s1">&#39;https://api.themoviedb.org&#39;</span><span class="p">,</span>
    <span class="nx">baseImagePath</span><span class="o">:</span> <span class="s1">&#39;http://image.tmdb.org/t/p/w185/&#39;</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">VIEWS_PATH</span> <span class="o">=</span> <span class="s1">&#39;./app_api/views/&#39;</span>

<span class="cm">/*</span>
<span class="cm"> *  Here we set the a path to the landing.pug file</span>
<span class="cm"> */</span>
<span class="kr">const</span> <span class="nx">views</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">VIEW_LANDING</span><span class="o">:</span> <span class="sb">`</span><span class="si">${</span><span class="nx">VIEWS_PATH</span><span class="si">}</span><span class="sb">landing.pug`</span><span class="p">,</span>
    <span class="nx">VIEW_MOVIE</span><span class="o">:</span> <span class="sb">`</span><span class="si">${</span><span class="nx">VIEWS_PATH</span><span class="si">}</span><span class="sb">movieView.pug`</span><span class="p">,</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * The api&#39;s base path is called when users hit our app for the</span>
<span class="cm"> * first time.  We&#39;ll use the onemsdk to parse the pug file and</span>
<span class="cm"> * generate the raw JSON response</span>
<span class="cm"> */</span>
<span class="nx">api</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>

    <span class="k">try</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">rootTag</span> <span class="o">=</span> <span class="nx">loadTemplate</span><span class="p">(</span><span class="nx">views</span><span class="p">.</span><span class="nx">VIEW_LANDING</span><span class="p">,</span> <span class="p">{})</span>
        <span class="kd">let</span> <span class="nx">response</span> <span class="o">=</span> <span class="nx">Response</span><span class="p">.</span><span class="nx">fromTag</span><span class="p">(</span><span class="nx">rootTag</span><span class="p">)</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">())</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="nx">success</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;server error&#39;</span> <span class="p">})</span>
    <span class="p">}</span>
<span class="p">})</span>

<span class="nx">api</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/movie/:id&#39;</span><span class="p">,</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>

    <span class="kd">let</span> <span class="nx">movieId</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span>

    <span class="k">try</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">request</span><span class="p">(</span><span class="nx">urlJoin</span><span class="p">(</span><span class="nx">moviedbProps</span><span class="p">.</span><span class="nx">baseUrl</span><span class="p">,</span> <span class="sb">`/3/movie/</span><span class="si">${</span><span class="nx">movieId</span><span class="si">}</span><span class="sb">`</span><span class="p">),</span> <span class="p">{</span>
            <span class="nx">json</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
                <span class="s1">&#39;Authorization&#39;</span><span class="o">:</span> <span class="s1">&#39;Bearer &#39;</span> <span class="o">+</span> <span class="nx">READ_ACCESS_TOKEN</span>
            <span class="p">}</span>
        <span class="p">})</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">poster_path</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">data</span><span class="p">.</span><span class="nx">poster_path</span> <span class="o">=</span> <span class="nx">urlJoin</span><span class="p">(</span><span class="nx">moviedbProps</span><span class="p">.</span><span class="nx">baseImagePath</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">poster_path</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="kd">let</span> <span class="nx">rootTag</span> <span class="o">=</span> <span class="nx">loadTemplate</span><span class="p">(</span><span class="nx">views</span><span class="p">.</span><span class="nx">VIEW_MOVIE</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
        <span class="kd">let</span> <span class="nx">response</span> <span class="o">=</span> <span class="nx">Response</span><span class="p">.</span><span class="nx">fromTag</span><span class="p">(</span><span class="nx">rootTag</span><span class="p">)</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">())</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="nx">success</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;server error&#39;</span> <span class="p">})</span>
    <span class="p">}</span>
<span class="p">})</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">api</span>
</pre></div>
</td></tr></table>

<p><code>/routes/index.js</code> contains a route for the movie view page, when the user clicks on a movie title, the ONEm Framework will issue an <code>HTTP GET</code> callback to the <strong>href</strong> associated with that option, eg in landing.pug we have the following line:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nt">a</span>(<span class="na">href=</span><span class="s">&#39;/movie/76341/&#39;</span>) Mad max
</pre></div>
</td></tr></table>

<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Later in this tutorial, we will tell the ONEm Framework to use the base path of <code>/api</code>, which will eventually translate into <code>HTTP GET /api/movie/76341</code> when the user selects to view Mad Max.</p>
</div>
<p>Ok, so a quick recap. We have created two views using pug. Our web server is ready to accept callbacks from <code>/api</code> and <code>/api/movie/{:id}</code>.</p>
<p>So what’s remaining now is to complete the setup of our micro-app.</p>
<ol>
<li>Create a <code>.env</code> file in the project root path:</li>
</ol>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>PORT=3000
READ_ACCESS_TOKEN=&lt;themoviedb API Read Access Token (v4 auth)
</pre></div>
</td></tr></table>

<ol>
<li>We’ll use <a href="http://ngrok.com">ngrok</a> to give us a publicly accessible url to our micro-app at <strong>localhost:3000</strong>.</li>
</ol>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$ ngrok http <span class="m">3000</span>
</pre></div>
</td></tr></table>

<p>Copy the link provided by ngrok, it will be something like <code>https://6f1ca0d4.ngrok.io</code></p>
<ol>
<li>
<p>In the <a href="https://developer-portal.onem.zone">ONEm Developer Portal</a>, select <em>Create App</em> and set the callback path to your micro-app appending <code>/api</code> to the base path, eg: <code>https://6f1ca0d4.ngrok.io/api</code></p>
</li>
<li>
<p>In the <a href="https://developer-portal.onem.zone">ONEm Developer Portal</a>, select your new app and then select the <em>Web channel</em> tab. Copy/paste the javascript code shown in the tab, into the body section of the <code>/public/index.html</code> of your Micro-app:</p>
</li>
</ol>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>...
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Movie micro-app<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://bot.onem.zone/bundle.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
        <span class="nx">ONEmStart</span><span class="p">({</span> <span class="nx">app_id</span><span class="o">:</span> <span class="s2">&quot;&lt;&lt;app_id&gt;&gt;&quot;</span> <span class="p">}).</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">);</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table>

<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>This code snippet can be included in any website, if you have access to another website’s <code>index.html</code>, then go ahead and try it.</p>
</div>
<h2 id="running">Running<a class="headerlink" href="#running" title="Permanent link">&para;</a></h2>
<p>Fire up your micro-app:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$ node index
</pre></div>
</td></tr></table>

<p>In your browser, visit <strong>localhost:3000</strong> (or where ever your app is configured to listen)</p>
<p>The ONEm micro-app should be visible in bottom right-hand corner. Click the icon to open.</p>
<p><img style="height:auto;width:100%" src="/assets/moviedb/fullscreen.png"/></p>
<p>You can also view the SMS client from the <a href="https://developer-portal.onem.zone">ONEm Developer Portal</a> test client. After registering your mobile number, you can test out the SMS interface by entering # followed by your micro-app name in the input box.</p>
<div style="text-align:center">
    <img style="height:auto;width:400px" src="/assets/moviedb/sms-input.png">
</div>

<p>Now head over to <a href="/guides/moviedb/part2/">part 2</a> where things get a bit more interesting...</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../../core/reserved_verbs/" title="SMS reserved verbs" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                SMS reserved verbs
              </span>
            </div>
          </a>
        
        
          <a href="../part2/" title="Part 2 - Adding a form" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Part 2 - Adding a form
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.2ba8dec4.js"></script>
      
      <script>app.initialize({version:"1.1",url:{base:"../../.."}})</script>
      
        <script src="../../../assets/js/jquery-3.4.1.min.js"></script>
      
    
  </body>
</html>